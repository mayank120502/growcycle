<?php
 use Tygh\Enum\NotificationSeverity; use Tygh\Enum\YesNo; use Tygh\Registry; defined('BOOTSTRAP') or die('Access denied'); if ($_SERVER['REQUEST_METHOD'] == 'POST') { return [CONTROLLER_STATUS_OK]; } $is_ga4 = fn_sd_ga_is_ga4(Registry::get('addons.sd_google_analytics.tracking_code')); $sd_ga_params_name_ga4 = $is_ga4 ? 'item_' : ''; Tygh::$app['view']->assign([ 'sd_ga_params' => fn_sd_ga_add_tracker_fields(), 'sd_ga_crossdomain' => fn_sd_ga_add_crossdomain_fields(), 'sd_ga_params_name_ga4' => $sd_ga_params_name_ga4, ]); if ( isset(Tygh::$app['session']['sd_ga']) && !defined('AJAX_REQUEST') ) { Registry::get('view')->assign('sd_ga', Tygh::$app['session']); unset(Tygh::$app['session']['sd_ga']); } if (Registry::get('addons.sd_google_analytics.ga_user_id_law') == YesNo::YES) { if (!empty($_REQUEST['ga_user_id_law']) && $_REQUEST['ga_user_id_law'] == YesNo::YES) { Tygh::$app['session']['ga_user_id_law'] = true; } if (!defined('AJAX_REQUEST') && empty(Tygh::$app['session']['ga_user_id_law']) ) { if (Registry::get('addons.sd_cart_sharing.status') == 'A' && !empty($_REQUEST['cart_link_id']) ) { $current_url = $_SERVER['REQUEST_URI']; } else { $current_url = Registry::get('config.current_url'); } $url = fn_link_attach($current_url, 'ga_user_id_law=' . YesNo::YES); $url = str_replace('&', '&amp;', $url); $text = __('ga_user_id_law', ['[url]' => fn_url($url)]); fn_delete_notification('ga_user_id_law'); fn_set_notification( NotificationSeverity::WARNING, __('warning'), $text, 'K', 'ga_user_id_law' ); } else { fn_delete_notification('ga_user_id_law'); } } if (fn_allowed_for('MULTIVENDOR')) { fn_sd_ga_cache_vendor_tracking_codes(); Tygh::$app['view']->assign([ 'vendor_tracking_codes' => fn_sd_ga_get_vendor_tracking_codes_from_cache(), ]); } 