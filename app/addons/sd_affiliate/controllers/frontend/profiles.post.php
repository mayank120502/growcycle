<?php
 use Tygh\Registry; use Tygh\Enum\AffiliateUserTypes; defined('BOOTSTRAP') or die('Access denied'); if ($_SERVER['REQUEST_METHOD'] == 'POST') { if ($mode == 'save_custom_affiliate_parameter') { if (!empty($_REQUEST['custom_affiliate_parameter'])) { if (!empty($auth['user_id']) && $auth['user_type'] == AffiliateUserTypes::PARTNER) { fn_sd_affiliate_save_custom_affiliate_parameter( $_REQUEST['custom_affiliate_parameter'], $auth['user_id'] ); } } else { fn_set_notification('E', __('error'), __('addons.sd_affiliate.empty_custom_affiliate_parameter')); } return [CONTROLLER_STATUS_REDIRECT, 'profiles.update&selected_section=affiliates']; } return; } if ($mode == 'update' || $mode == 'add') { $user_type = (isset($_REQUEST['user_type'])) ? $_REQUEST['user_type'] : $auth['user_type']; $profile_fields = fn_get_profile_fields($user_type); Tygh::$app['view']->assign('profile_fields', $profile_fields); if ($user_type == AffiliateUserTypes::PARTNER && !empty($auth['user_id']) && $mode == 'update') { $is_approved = fn_sd_affiliate_is_approved($auth['user_id']); $general_affiliate_parameter = Registry::get('addons.sd_affiliate.custom_affiliate_parameter'); if ($is_approved && !empty($general_affiliate_parameter)) { Registry::set('navigation.tabs.affiliates', [ 'title' => __('affiliates_partnership'), 'js' => true ]); Tygh::$app['view']->assign( 'custom_affiliate_parameter', fn_sd_affiliate_get_custom_affiliate_parameter($auth['user_id']) ); } Tygh::$app['view']->assign('general_affiliate_parameter', $general_affiliate_parameter); } } elseif ($mode == 'check_custom_affiliate_parameter') { if (!empty($_REQUEST['affiliate_parameter'])) { fn_sd_affiliate_check_custom_affiliate_parameter($_REQUEST['affiliate_parameter'], true); } else { fn_set_notification('E', __('error'), __('addons.sd_affiliate.empty_custom_affiliate_parameter')); } die(); } elseif ($mode == 'delete_custom_affiliate_parameter') { if (!empty($auth['user_id'])) { fn_sd_affiliate_save_custom_affiliate_parameter('', $auth['user_id']); } return [CONTROLLER_STATUS_REDIRECT, 'profiles.update&selected_section=affiliates']; } 