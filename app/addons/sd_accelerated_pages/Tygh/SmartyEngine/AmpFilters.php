<?php
 namespace Tygh\SmartyEngine; use Tygh\Registry; use Tygh\Embedded; use Tygh\Tools\Url; class AmpFilters { public static function preInitStyles($content, \Smarty_Internal_Template $template) { static $styles = null; static $controller = null; static $style_list = null; if ($controller === null) { $controller = Registry::get('runtime.controller'); } if ($styles === null) { $styles = Registry::get('amp_styles'); } if ($style_list === null) { $css_dir = fn_get_theme_path('[themes]/[theme]', 'C') . '/css/components/'; $file_styles = fn_get_dir_contents($css_dir, false, true, 'less', '', true); $style_list = array(); foreach ($file_styles as $filename) { $style_list[] = (string)pathinfo($filename, PATHINFO_FILENAME); } } foreach ($style_list as $style_name) { if (!isset($styles[$controller][$style_name])) { $pattern = '/' . $style_name . '/'; if (preg_match($pattern, $content, $matches)) { $styles[$controller][$style_name] = true; Registry::set('amp_styles', $styles); } } } return $content; } } 