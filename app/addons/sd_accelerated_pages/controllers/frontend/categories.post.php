<?php
 use Tygh\Registry; defined('BOOTSTRAP') or die('Access denied'); if ($_SERVER['REQUEST_METHOD'] == 'POST') { return array(CONTROLLER_STATUS_OK); } if (Registry::get('is_amp_link')) { $params = $_REQUEST; if ($mode == 'view') { $category_data = Tygh::$app['view']->getTemplateVars('category_data'); if (isset($_REQUEST['json'])) { if (!fn_sd_accelerated_pages_check_cors($_SERVER)) { header('HTTP/1.0 401 Unauthorized'); exit; }; list($products, $search) = fn_sd_accelerated_pages_get_products($params); header('Content-Type: application/json', true); echo(json_encode( array( 'category' => $category_data, 'products' => array_values($products), 'search' => $search ) )); exit; } $amp_scripts = Tygh::$app['view']->getTemplateVars('amp_scripts'); $amp_scripts['list'] = true; Tygh::$app['view']->assign('amp_scripts', $amp_scripts); $subcategories = Tygh::$app['view']->getTemplateVars('subcategories'); if (empty($subcategories)) { $subcategories = fn_get_subcategories($category_data['parent_id']); Tygh::$app['view']->assign('subcategories', $subcategories); } Tygh::$app['view']->assign('sorting', fn_get_products_sorting()); Tygh::$app['view']->assign('sorting_orders', fn_get_products_sorting_orders()); } } elseif ($mode == 'view' && !empty($_REQUEST['category_id']) && Registry::get('addons.seo.status') == 'A') { Tygh::$app['view']->assign('amphtml', fn_url('amp/index.php?dispatch=categories.view&category_id=' . $_REQUEST['category_id'])); } 